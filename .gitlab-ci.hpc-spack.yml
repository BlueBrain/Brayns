include:
  - project: hpc/gitlab-pipelines
    file: spack-build-components.gitlab-ci.yml

default:
  tags: []

spack-setup:
  tags: [bb5_map]
spack-build:
  tags: [bb5_map]
  extends: .spack_setup_ccache
  stage: test
  variables:
    SALLOC_ACCOUNT: proj3
    SBATCH_ACCOUNT: proj3
    SLURM_ACCOUNT: proj3
    bb5_account: proj3
    SPACK_PACKAGE_NAME: brayns
    SPACK_PACKAGE_COMPILER: gcc
    SPACK_PACKAGE_SPEC: ^ospray@1.8.5%intel +brion
    DATADIR: /tmp 
  
  # TEST: TO BE REMOVED BEFORE MERGE!!!
  rules:
  #  - if: $CI_MERGE_REQUEST_IID
    # run on default branch in order to upload coverage report
    - if: $CI_COMMIT_BRANCH == "BRAYNS_306_Migrate_CI_to_Gitlab"
