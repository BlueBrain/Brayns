# Copyright (c) 2015-2022, EPFL/Blue Brain Project
# All rights reserved. Do not distribute without permission.
# Responsible Author: Nadir Roman Guerrero <nadir.romanguerrero@epfl.ch>
#
# This file is part of Brayns <https://github.com/BlueBrain/Brayns>

list(APPEND CMAKE_MODULE_PATH ${OSPRAY_CMAKE_ROOT})
include(osprayUse)

file(GLOB_RECURSE BRAYNSCYLINDRICCAMERA_SOURCES RELATIVE ${CMAKE_CURRENT_LIST_DIR} *.cpp)
file(GLOB_RECURSE BRAYNSCYLINDRICCAMERA_HEADERS RELATIVE ${CMAKE_CURRENT_LIST_DIR} *.h)
file(GLOB_RECURSE BRAYNSCYLINDRICCAMERA_ISPC_SOURCES RELATIVE ${CMAKE_CURRENT_LIST_DIR} *.ispc)

ispc_include_directories(${CMAKE_CURRENT_LIST_DIR}
    ${OSPRAY_INCLUDE_DIR}
    ${OSPRAY_INCLUDE_DIR}/ospray/SDK/modules/cpu)
ispc_compile(${BRAYNSCYLINDRICCAMERA_ISPC_SOURCES})
list(APPEND BRAYNSCYLINDRICCAMERA_SOURCES ${ISPC_OBJECTS})

add_library(braynsCylindricCamera SHARED ${BRAYNSCYLINDRICCAMERA_SOURCES} ${BRAYNSCYLINDRICCAMERA_HEADERS})

target_include_directories(braynsCylindricCamera PUBLIC
    "$<BUILD_INTERFACE:${CMAKE_CURRENT_LIST_DIR}>"
    "$<INSTALL_INTERFACE:include>")

target_include_directories(braynsCylindricCamera PRIVATE
    ${CMAKE_CURRENT_BINARY_DIR}/camera # to find the autogenerated *_ispc.h file
    ${OSPRAY_INCLUDE_DIR} # to fix relative imports within Ospray SDK
    ${OSPRAY_INCLUDE_DIR}/ospray/SDK/common
    ${OSPRAY_INCLUDE_DIR}/ospray/SDK/modules/cpu
    ${RKCOMMON_INCLUDE_DIRS})

target_link_libraries(braynsCylindricCamera PRIVATE
    braynsEngine
    braynsPluginAPI
    braynsNetwork
    rkcommon::rkcommon
    ospray::ospray
    ospray::ospray_sdk
    ospray::ospray_module_cpu)

target_compile_options(braynsCylindricCamera PRIVATE ${BRAYNS_COMPILE_OPTIONS})

set_target_properties(braynsCylindricCamera
    PROPERTIES
    VERSION ${BRAYNS_VERSION}
    SOVERSION ${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}
)

install(TARGETS braynsCylindricCamera
    EXPORT braynsCylindricCamera-targets
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
)

install(EXPORT braynsCylindricCamera-targets
    DESTINATION share/braynsCylindricCamera/CMake
)
